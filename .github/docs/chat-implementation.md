채팅의 구현은 stomp를 활용했습니다. 

- stomp 사용의 이유 : stomp는 websocket 연결을 기반으로 추상화 된 구독/발행 기능을 제공.

/v1/connect로 요청이 오면 sockJS 기반 http 연결을 ws로 업그레이드 해줍니다. (이때 인터셉터에서 jwt 토큰을 통해 로그인한 사용자인지 확인합니다)
이후 클라이언트쪽에서 /v1/topic/roomid로 subscribe 요청이 오면 
인터셉터에서 stomp header에 들어있는 jwt 토큰을 꺼내 해당 방에 들어갈 권한이 있는지 확인합니다.

이렇게 하는 이유는 서블릿 필터는 http 요청/응답에만 관여하고 이후 ws 요청에는 관여할 수 없기 때문입니다.
따라서 인터셉터에서 요청을 가로채 토큰 검증과 해당 방 구독 권한을 확인하고 채팅방에 들어가게 해줍니다. 

/v1/publish/roomid로 publish 요청이 오면 메시지를 db에 저장하고 필요한 값들을 dto로 전환하여
레디스의 특정 channel에 메시지를 발행합니다. 
해당 레디스와 연동된 다른 서버에서는 해당 channel에 온 메시지 값을 읽어 해당 서버에서 해당 방을 구독하고 있는
사용자에게 채팅 내역을 보내줍니다. 

websocket을 직접 사용한다면 ws 연결시 해당 세션을 저장할 방을 따로 만들어줘야하고 
메시지 발행시 해당 방의 정보를 읽어 구독된 사용자에게 일일이 메시지를 보내야 합니다. 
연결이 끊길때도 마찬가지로 일일이 관리해줘야 합니다. 
하지만 stomp를 사용하면 커스터마이징은 한계가 있어도 이미 추상화된 틀을 사용하기 때문에
빠르게 채팅 기능을 구현할 수 있습니다. 

제 서비스의 채팅관련 기능은 1:1 채팅, 단체 채팅, 단체 채팅방 개설, 읽지 않은 메시지 갯수 표시 등등이 있습니다.
채팅 메시지에 이미지나 영상을 올리는 것은 불가능합니다.

채팅 관련 파일들은 community/chat package에 모두 있으며 redis 설정만 community/config/RedisConfig에 있습니다. 

아래는 제 서비스 ERD 주소 입니다.
https://www.erdcloud.com/d/JQnRbxZw8QRe8eynC