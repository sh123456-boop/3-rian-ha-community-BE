# 📏 DB 테이블 크기 계산

## 1. 목적

현재 서비스의 ERD(엔티티 구조)를 기준으로,엔티티별 **1 row 당 저장 용량**을 추정하고 주요 쓰기 작업(회원가입, 게시글 작성, 채팅 등)에 따른 **월간 데이터 증가량**을 계산한 뒤 InnoDB 특성(페이지 단편화 등)을 감안하여 **월/3년 기준 필요 스토리지 용량**을 추정하기 위한 문서입니다.
(erd : https://www.erdcloud.com/d/S8d6y4Zuph7nm5az3)
---

## 2. 공통 가정

### 2.1 DB / 스토리지 가정

- DB: **MySQL InnoDB**
- InnoDB row 고정 오버헤드: **18B**
    - 5B row header
    - 6B trx id
    - 7B roll ptr

### 2.2 타입별 크기

- `DATETIME` : 5B
- `BIGINT` : 8B
- `INT` : 4B
- `BOOLEAN` : 1B
- `ENUM` : 1B
- `VARCHAR(N)` :
    - 실제 문자열 길이 + length 필드
    - `N ≤ 255` → length 1B
    - `N ≥ 256` → length 2B
- `TEXT` :
    - 20B 포인터 (실제 문자열은 별도 페이지에 저장)

### 2.3 문자열 길이 가정 (평균)

- email : 35B
- password hash : 60B
- nickname : 8B
- s3 key : 120B
- 게시글 제목 : 40B
- 본문 : 2KB
- 댓글 : 150B
- 리프레시 토큰 : 64B
- 만료 문자열 : 32B
- OAuth provider : 6B
- 채팅방 이름 : 24B
- 채팅 메시지 : 180B

---

## 3. 엔티티별 row 크기 (추정)

> 아래 크기는 InnoDB row 오버헤드(18B)와 인덱스 오버헤드를 포함한, **1 row 당 저장 용량 추정치**입니다.

| 엔티티                        | 비고                                             | 1 row 크기 |
|------------------------------|--------------------------------------------------|-----------:|
| `users`                      | 유니크 인덱스 2개 포함                           | 205B       |
| `images`                     | `id`, `s3_key`, `user_id`                        | 148B       |
| `posts`                      | 제목 + 본문 포함                                 | 2.1KB      |
| `comments`                   | 댓글 본문 포함                                   | 204B       |
| `post_images`                | 합성 PK + `orders`                               | 38B        |
| `counts`                     | `id` + 3개의 `INT`                               | 38B        |
| `user_like_posts`            | 복합 PK, 보조 인덱스 2개                         | 55B        |
| `refresh_entity`             | `id`, `user_id`, `refresh`, `expiration`         | 132B       |
| `chat_rooms`                 | `name`, `is_group_chat`, `created_at`, `...`     | 95B        |
| `chat_participants`          | `user_id`, `chat_room_id` 등                     | 76B        |
| `chat_messages`              | 메시지 내용 포함                                 | 250B       |
| `read_status`                | `is_read`, `chat_room_id`, `chat_message_id` 등  | 61B        |

---

## 4. 서비스별 월간 데이터 증가량

단위 변환 가정:

- 1MB = 10⁶ B
- 1GB = 10⁹ B

### 4.1 유저 회원가입

- 가정: **신규 가입자 100,000명 / 월**
- 엔티티: `users`
- 계산:
    - 100,000건 × 205B = 20,500,000B
    - ≒ **20.5MB / 월**

---

### 4.2 게시글 작성

- 가정:
    - 게시글 작성 QPS: 약 0.06 QPS
    - 단순 환산: 약 **150,000건 / 월**
- 엔티티:
    - `posts` (2,100B)
    - `counts` (38B)
- 1 게시글 작성 시 증가 용량:
    - 2,100B + 38B = **2,138B**
- 계산:
    - 150,000건 × 2,138B = 320,700,000B
    - ≒ **320.7MB / 월**

---

### 4.3 이미지 저장

- 가정: **150,000건 / 월**
- 엔티티:
    - `images` (148B)
    - `post_images` (38B)
- 1 이미지 저장 시 증가 용량:
    - 148B + 38B = **186B**
- 계산:
    - 150,000건 × 186B = 27,900,000B
    - ≒ **27.9MB / 월**

---

### 4.4 댓글 작성

- 가정: **450,000건 / 월**
- 엔티티: `comments` (204B)
- 계산:
    - 450,000건 × 204B = 91,800,000B
    - ≒ **91.8MB / 월**

---

### 4.5 좋아요

- 가정: **1,500,000건 / 월**
- 엔티티: `user_like_posts` (55B)
- 계산:
    - 1,500,000건 × 55B = 82,500,000B
    - ≒ **82.5MB / 월**

---

### 4.6 채팅방 생성

- 가정: **20,000개 / 월**
- 엔티티: `chat_rooms` (95B)
- 계산:
    - 20,000건 × 95B = 1,900,000B
    - ≒ **1.9MB / 월**

---

### 4.7 채팅방 참여 + 읽음 상태

- 가정: **50,000건 / 월**
- 엔티티:
    - `chat_participants` (76B)
    - `read_status` (61B)
- 1회 참여 시 증가 용량:
    - 76B + 61B = **137B**
- 계산:
    - 50,000건 × 137B = 6,850,000B
    - ≒ **6.85MB / 월** (≈ 6.8MB)

---

### 4.8 채팅 메시지 작성

- 가정: **45,000,000건 / 월**
- 엔티티: `chat_messages` (250B)
- 계산:
    - 45,000,000건 × 250B = 11,250,000,000B
    - ≒ 11,250MB
    - ≒ **11.25GB / 월**

---

### 4.9 월간 합산 (순수 데이터 기준)

- 채팅 메시지 **외** 엔티티:

    - 유저 가입: 20.5MB
    - 게시글 작성: 320.7MB
    - 이미지 저장: 27.9MB
    - 댓글 작성: 91.8MB
    - 좋아요: 82.5MB
    - 채팅방 생성: 1.9MB
    - 채팅방 참여 + 읽음 상태: 6.85MB

  → 합계:  
  20.5 + 320.7 + 27.9 + 91.8 + 82.5 + 1.9 + 6.85  
  ≒ **552.15MB / 월** (≈ 0.55GB)

- 채팅 메시지:

    - ≒ **11.25GB / 월**

- 전체 합계:

    - 0.55GB + 11.25GB
    - ≒ **11.8GB / 월**

---

## 5. InnoDB 페이지 단편화 및 여유분 반영

InnoDB는 모든 데이터를 16KB 페이지 단위로 저장하며, 페이지 내부 단편화 및 삭제/수정에 따른 빈 공간이 발생합니다. 또한 운영 중 여유 공간을 고려해 **20%~30% 정도의 추가 용량**을 잡는 것이 안전합니다.

여기서는 **25% 여유분**을 가정합니다.

- 순수 데이터(엔티티 + 인덱스): 약 **11.8GB / 월**
- 여유분 25% 반영:

    - 11.8GB × 1.25 = 14.75GB
    - ≒ **15GB / 월**

> 따라서, InnoDB 페이지 단편화 및 운영 여유 공간을 고려한 **월별 필요 저장 공간은 약 15GB**로 추정할 수 있습니다.

---

## 6. 3년(36개월) 기준 총 저장 공간 추정

- 가정:
    - 3년 동안 트래픽/사용량 패턴이 동일하게 유지
    - 샤딩/아카이빙 없이 동일 DB에 누적
- 계산:

    - 15GB / 월 × 36개월 = 540GB

> 결론적으로, **같은 DB 인스턴스를 3년간 유지하는 경우 약 540GB의 스토리지 용량**을 준비하는 것이 안전한 추정입니다.
