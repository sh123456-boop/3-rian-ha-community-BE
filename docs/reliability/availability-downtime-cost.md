# 🕒 가용성(Availability)과 장애 시간에 따른 비용 손실 계산

## 1. 개요

이 문서는 서비스 인프라의 **가용성(Availability)** 수준에 따라,
- 월간 **예상 장애 시간**을 추정하고
- 광고 수익 기준으로 **가용성 선택에 따른 손해 비용**을 비교하기 위한 문서입니다.

---

## 2. 가용성과 장애 시간

### 2.1 인스턴스별 가용성 비교

한 달 기준 가용성에 따라 예상되는 장애 시간과,  
싱글 AZ 대비 멀티 AZ 구성 시 감소하는 장애 시간은 다음과 같습니다.

| 리소스        | 싱글 AZ 가용성 | 멀티 AZ 가용성 | 장애 시간 차이 (싱글 → 멀티) |
|--------------|----------------|----------------|------------------------------|
| EC2          | 99.5%          | 99.99%         | 약 **3시간 33분**            |
| RDS          | 99.5%          | 99.95%         | 약 **3시간 17분**            |
| ElastiCache  | 99.5%          | 99.99%         | 약 **3시간 33분**            |
| ALB          | -              | 99.99%         | -                            |

> 한 달 기준(약 30일) 가용성별 장애 시간 요약:
>
> - **99.5%**  → 약 **3시간 37분** 장애
> - **99.95%** → 약 **20분** 장애
> - **99.99%** → 약 **4분** 장애

---

## 3. 광고 단가 및 손해 산정 기준

### 3.1 광고 단가

- 제 서비스의 광고 단가(로고 배너 + 날개 배너 + 리스트 좌측 광고)는  
  **시간당 61,000원**으로 가정합니다.

### 3.2 과금 구조 및 트래픽 반영

- 과금 기준: **1,000회 노출당 광고 단가**를 받는 구조
- 트래픽이 4배가 되면, 같은 시간 장애가 발생해도 **손해 금액은 4배**가 됩니다.
- 즉, **장애가 언제 발생하느냐(트래픽 피크 타임 vs 비피크 타임)** 에 따라 손해가 크게 달라집니다.

### 3.3 분석 대상 인스턴스

서비스 필수 구성 요소는 다음 3개입니다.

- Express 서버 (웹 프론트/백엔드 API)
- Spring 서버 (백엔드 메인 API)
- MySQL 서버 (RDS 혹은 EC2 기반 MySQL)

따라서, 아래 계산에서는 **3개의 인스턴스 장애 시간을 모두 고려**하여 손해를 산정합니다.

---

## 4. 시나리오별 손해 비용 분석

인스턴스 장애가 **언제, 어떤 패턴으로 발생하는지**에 따라  
손해를 3가지 시나리오로 나누어 계산했습니다.

- **최악**: 세 인스턴스가 **각기 다른 트래픽 피크 시점**에 장애 발생
- **평균**: 세 인스턴스가 **서로 다른 시점(비피크 포함)** 에 분산되어 장애 발생
- **최선**: 세 인스턴스가 **동일한 시간대**에 동시에 장애 발생

### 4.1 최악 시나리오
> Express, Spring, MySQL 서버가 **각기 다른 트래픽 피크 시간대**에 장애 발생

트래픽이 높은 시간대에 각각 장애가 발생하므로,  
동일한 장애 시간이라도 **손해는 크게 증폭**됩니다.

| 가용성 구성 | 장애 시간 총합 | 손해 총합       |
|-------------|----------------|-----------------|
| 멀티 AZ     | 약 **12분**    | **48,800원**    |
| 싱글 AZ     | 약 **10시간 30분** | **2,562,000원** |

---

### 4.2 평균 시나리오
> Express, Spring, MySQL 서버가 **서로 다른 시점(트래픽 피크 X 포함)** 에 장애 발생

트래픽 피크와 비피크가 섞여 있는 평균적인 상황을 가정합니다.

| 가용성 구성 | 장애 시간 총합 | 손해 총합      |
|-------------|----------------|----------------|
| 멀티 AZ     | 약 **12분**    | **12,200원**   |
| 싱글 AZ     | 약 **10시간 30분** | **640,500원**  |

---

### 4.3 최선 시나리오
> Express, Spring, MySQL 서버가 **동일한 시간대**에 동시에 장애 발생

동일 시간대에 한 번에 장애가 발생하므로,  
전체 장애 시간 자체는 여전히 크더라도, 광고 손해는 상대적으로 작게 나옵니다.

| 가용성 구성 | 장애 시간 총합     | 손해 총합    |
|-------------|--------------------|-------------|
| 멀티 AZ     | 약 **4분**         | **4,000원** |
| 싱글 AZ     | 약 **3시간 30분**  | **213,500원** |

---

## 5. 영역별 손해 차익 정리

위 3가지 시나리오에 대해,  
**싱글 AZ → 멀티 AZ로 전환할 때 감소하는 손해(= 손해 차익)** 을 정리하면 다음과 같습니다.

| 시나리오 | 영역별 손해 차익 (싱글 AZ 대비 멀티 AZ 절감액) |
|----------|----------------------------------------------|
| 최악     | **2,514,000원**                              |
| 평균     | **628,300원**                                |
| 최선     | **209,500원**                                |

> 즉, **트래픽이 높은 시간대에 장애가 얼마나 겹쳐 발생하는지**에 따라  
> 멀티 AZ 구성의 경제적 이득(손해 절감 폭)이 크게 달라집니다.

---

## 6. 결론 

현재 단계에서는 **“가용성 수준에 따른 잠재 손해액”** 을 계산했습니다.

- 멀티 AZ로 갈수록:
    - **장애 시간은 줄고**
    - **광고 수익 손실도 크게 감소**하지만
    - 동시에 **인프라 비용(EC2/RDS/ElastiCache/ALB 등)이 증가**합니다.

따라서 무작정 고가용성만을 목표로 클라우드에 비용을 쓰기보다는,  
이번에 계산한 **장애로 인한 잠재 손해액**과 **고가용성 인프라 도입 비용**을 함께 비교·분석한 뒤  
서비스의 특성과 성장 단계에 맞는 **합리적인 가용성 수준으로 인프라를 설계하는 것**이 중요하다고 생각합니다.
