# 💸 이미지 저장 및 전송 비용 계산 (MySQL vs S3, S3 vs CloudFront)

## 1. 이미지 트래픽 요구사항 정리

커뮤니티 서비스 특성상 **이미지 저장/전송 비용**이 전체 서버 운영비에서 큰 비중을 차지합니다.  
앞으로의 비용 비교를 위해, 먼저 서비스의 이미지 관련 트래픽을 정리합니다.

### 1.1 일간 기준 요구사항

- 메인 게시물 페이지 조회: **2,500,000회 / 일**
- 게시물 상세 조회: **2,500,000회 / 일**
- 이미지 업로드: **5,000회 / 일**
- 이미지 평균 크기: **200KB**

### 1.2 월간 기준 환산

> 30일 기준으로 환산

- 메인 게시물 페이지:  
  → 2,500,000회/일 × 30일 = **75,000,000회 / 월**
- 게시물 상세 조회:  
  → 2,500,000회/일 × 30일 = **75,000,000회 / 월**

메인 게시물 페이지 렌더링 시, 각 게시물 작성자의 프로필 이미지가 함께 로딩된다고 가정합니다.

- 메인 페이지 1회 로딩 시 **프로필 이미지 9개** 로딩
- 게시물 상세 조회 1회당 **이미지 1개** 로딩 (대표 이미지 등)

이를 바탕으로 월간 이미지 조회 수를 추정하면:

- 메인 페이지 이미지 조회: 75,000,000 × 9 = **675,000,000회**
- 상세 페이지 이미지 조회: 75,000,000 × 1 = **75,000,000회**
- **월간 이미지 조회 합계:**  
  → 675,000,000 + 75,000,000 = **750,000,000회 / 월**

월간 업로드 및 데이터량:

- **월간 이미지 업로드 수:**  
  → 5,000 × 30 = **150,000회 / 월**
- **월간 이미지 저장 데이터량:**  
  → 5,000 × 200KB × 30 = **30GB / 월**
- **월간 이미지 전송 데이터량:**  
  → 750,000,000 × 200KB = **150TB / 월**

---

## 2. 이미지 저장 위치 비교: MySQL vs S3

이미지를 **DB에 직접 저장할 것인지**, **오브젝트 스토리지(S3)에 저장할 것인지**에 따라 스토리지 비용이 크게 달라집니다.

### 2.1 가정: GB당 월간 비용

| 저장소  | GB당 월간 비용 | 내 서비스 3년간 보관 비용 |
|--------|----------------|---------------------------|
| MySQL  | 0.131 USD      | 141.48 USD                |
| S3     | 0.025 USD      | 27 USD                    |

- 월간 이미지 저장량: **30GB**
- 3년(36개월) 동안 누적 GB-월:  
  → 30GB × 36개월 = 1,080 GB-월

계산:

- MySQL: 1,080 × 0.131 ≒ **141.48 USD**
- S3: 1,080 × 0.025 = **27 USD**

> **결론**:  
> 3년간 동일하게 이미지를 보관한다고 가정했을 때,  
> **S3는 MySQL 대비 약 20% 수준의 비용으로 운영 가능**합니다.

또한, 이미지를 DB에 저장하면:

- 트래픽 증가 시 **DB I/O에 직접적인 부하**가 가중되고
- 다른 엔티티(게시글, 댓글 등)와 **동일 스토리지·엔진을 공유**하게 되므로
- 성능 및 확장성 측면에서도 **S3에 이미지 분리 저장**이 훨씬 유리합니다.

---

## 3. 이미지 전송 비용: S3 단독 vs S3 + CloudFront

이제 **이미지 전송 비용** 관점에서 S3와 CloudFront를 비교합니다.  
여기서는 **S3 스토리지 비용은 제외**하고,  
요청/전송에 관련된 과금만 비교합니다.

### 3.1 과금 항목 정리

| S3                                   | CloudFront                         |
|-------------------------------------|------------------------------------|
| 요청수 (GET, PUT, LIST 등)          | HTTP/HTTPS 요청 수                 |
| 데이터 전송량 (GB 단위)             | 데이터 전송량 (GB 단위)           |
| 부가 기능 (라이프사이클 전환 등)    | 부가 기능 (로그, 기능 등)         |

> 아래 계산에서는 **부가기능 비용은 제외**하고,  
> **요청 수 + 데이터 전송량**만 반영했습니다.

---

### 3.2 최초 시나리오: 평균 이미지 크기 200KB

#### 3.2.1 S3 단독 사용

- **PUT 요청**
    - 단가: 0.005 USD / 1,000건
    - 월간 업로드: 150,000건  
      → 150,000 / 1,000 × 0.005 = **0.75 USD**

- **GET 요청**
    - 단가: 0.0004 USD / 1,000건
    - 월간 조회: 750,000,000건  
      → 750,000,000 / 1,000 × 0.0004 = **300 USD**

- **데이터 전송량: 150TB / 월**

    - 첫 10TB: 0.126 USD / GB → **1,260 USD**
    - 다음 40TB: 0.122 USD / GB → **4,880 USD**
    - 다음 100TB: 0.117 USD / GB → **11,700 USD**

- **총합**

    - 전송량: 1,260 + 4,880 + 11,700 = 17,840 USD
    - 요청 비용 포함: 17,840 + 300 + 0.75  
      → **약 18,141 USD / 월**

---

#### 3.2.2 S3 + CloudFront 사용

- **CloudFront HTTPS 요청**
    - 전체 요청 수: 750,000,000건
    - 무료: 10,000,000건
    - 과금 단가: 0.012 USD / 10,000건
    - 유료 요청: 740,000,000건  
      → 740,000,000 / 10,000 × 0.012 = **888 USD**

- **데이터 전송량: 150TB / 월**

    - 1TB: 무료
    - 다음 9TB: 0.12 USD / GB → **1,080 USD**
    - 다음 40TB: 0.10 USD / GB → **4,000 USD**
    - 다음 100TB: 0.095 USD / GB → **9,500 USD**

- **S3 요청 비용 (원본 저장소)**

    - PUT 요청: **0.75 USD**
    - GET 요청:
        - CloudFront 캐시 히트율: 80% 가정
        - S3로 가는 실제 GET 요청: 20%
        - 기존 300 USD의 20% → **60 USD**

- **총합**

    - CloudFront 전송 + 요청: 1,080 + 4,000 + 9,500 + 888 = 15,468 USD
    - S3 요청: 0.75 + 60 = 60.75 USD
    - **합산:** 약 **15,529 USD / 월**

> **결론**:  
> S3 단독(약 18,141 USD) 대비,  
> **S3 + CloudFront 조합(약 15,529 USD)** 이 더 저렴합니다.

---

## 4. 프로필 이미지 리사이징 적용 후 비용 재계산

위 계산에서 가장 크게 작용하는 건 **네트워크 전송량(150TB)** 입니다.  
이를 줄이기 위해, **프로필 이미지 크기를 200KB → 30KB로 리사이징** 하는 전략을 적용합니다.

### 4.1 가정

- 전체 이미지 조회의 **90%는 프로필 이미지 조회**라고 가정
- 나머지 10%는 게시글 내 콘텐츠 이미지 등, 기존 200KB 유지
- 프로필 이미지만 30KB로 축소

### 4.2 평균 이미지 크기 재계산

- 평균 크기 = 0.9 × 30KB + 0.1 × 200KB  
  = 27KB + 20KB = **47KB**

원래 200KB 기준 월간 전송량이 150TB였으므로,

- 새 전송량 = 150TB × (47KB / 200KB)  
  ≒ **35.25TB / 월**

---

### 4.3 S3 단독 사용 (리사이징 후)

- **PUT 요청**
    - 동일: **0.75 USD**

- **GET 요청**
    - 동일 요청 수: 750,000,000건
    - 단가: 0.0004 USD / 1,000건
    - 비용: **300 USD**

- **데이터 전송량: 35.25TB**

    - 첫 10TB: 0.126 USD / GB → **1,260 USD**
    - 남은 25.25TB: 0.122 USD / GB → **약 3,080 USD**

- **총합**

    - 전송량: 1,260 + 3,080 = 4,340 USD
    - 요청 비용 포함: 4,340 + 300 + 0.75  
      → **약 4,641 USD / 월**

---

### 4.4 S3 + CloudFront 사용 (리사이징 후)

- **CloudFront HTTPS 요청**
    - 요청 수는 동일: 750,000,000건
    - 무료 10,000,000건 제외
